<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>오늘의 뇌구조</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#inputBox {
  width: 420px;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 15px;
}

svg {
  background: #fff;
  border: 1px solid #ccc;
}

text {
  fill: #c0392b;
  font-weight: bold;
  cursor: move;
  user-select: none;
}
</style>
</head>

<body>

<input id="inputBox" placeholder="지금 머릿속 생각 입력 후 Enter" autofocus>

<svg id="brainSVG" width="600" height="600"
     xmlns="http://www.w3.org/2000/svg">

  <image
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADjCAMAAADdXVr2AAAA"
    x="0" y="0" width="600" height="600" />
</svg>

<button onclick="saveSVG()">이미지 저장</button>

<script>
const svg = document.getElementById("brainSVG");
const input = document.getElementById("inputBox");

let selected = null;
let offset = { x: 0, y: 0 };

// ✅ 엔터 입력 (keyup이 더 안정적)
input.addEventListener("keyup", e => {
  if (e.key === "Enter" && input.value.trim()) {
    createText(input.value.trim());
    input.value = "";
  }
});

function createText(text) {
  const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
  t.textContent = text;
  t.setAttribute("x", 300);
  t.setAttribute("y", 300);
  t.setAttribute("font-size", 24);

  t.addEventListener("mousedown", e => {
    selected = t;
    offset.x = e.offsetX - t.getAttribute("x");
    offset.y = e.offsetY - t.getAttribute("y");
  });

  svg.appendChild(t);

  // ✅ 텍스트 추가 후 입력창 포커스 복귀
  input.focus();
}

// 드래그 이동
svg.addEventListener("mousemove", e => {
  if (!selected) return;
  selected.setAttribute("x", e.offsetX - offset.x);
  selected.setAttribute("y", e.offsetY - offset.y);
});

svg.addEventListener("mouseup", () => {
  selected = null;
  input.focus(); // ✅ SVG 클릭 후에도 포커스 복구
});

svg.addEventListener("mouseleave", () => {
  selected = null;
  input.focus();
});

// SVG 저장
function saveSVG() {
  const serializer = new XMLSerializer();
  const source = serializer.serializeToString(svg);

  const blob = new Blob([source], { type: "image/svg+xml;charset=utf-8" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "오늘의_뇌구조.svg";
  a.click();

  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
