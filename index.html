<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>오늘의 뇌구조 (SVG)</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#inputBox {
  width: 420px;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 15px;
}

#brainWrapper {
  background: #fff;
  border: 1px solid #ccc;
}

text {
  fill: #c0392b;
  font-weight: bold;
  cursor: move;
  user-select: none;
}

text.selected {
  stroke: #888;
  stroke-dasharray: 2;
}

#saveBtn {
  margin-top: 15px;
  padding: 10px 20px;
  cursor: pointer;
}
</style>
</head>

<body>

<input id="inputBox" placeholder="지금 머릿속 생각을 입력하고 Enter">

<div id="brainWrapper">
<svg id="brainSVG" width="600" height="600"
     viewBox="0 0 600 600"
     xmlns="http://www.w3.org/2000/svg">

  <!-- 배경 뇌 이미지 -->
  <image href="brain.png" x="0" y="0" width="600" height="600"/>

</svg>
</div>

<button id="saveBtn">이미지 저장</button>

<script>
const svg = document.getElementById("brainSVG");
const input = document.getElementById("inputBox");
let selected = null;
let dragging = false;
let offsetX = 0;
let offsetY = 0;

// 엔터 → 텍스트 추가
input.addEventListener("keydown", e => {
  if (e.key === "Enter" && input.value.trim()) {
    createText(input.value.trim());
    input.value = "";
  }
});

function createText(content) {
  const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
  t.setAttribute("x", 300);
  t.setAttribute("y", 300);
  t.setAttribute("font-size", 24);
  t.textContent = content;

  t.addEventListener("mousedown", e => {
    dragging = true;
    select(t);
    offsetX = e.offsetX - t.getAttribute("x");
    offsetY = e.offsetY - t.getAttribute("y");
  });

  t.addEventListener("dblclick", e => {
    e.stopPropagation();
    const newText = prompt("수정", t.textContent);
    if (newText !== null) t.textContent = newText;
  });

  svg.appendChild(t);
  select(t);
}

svg.addEventListener("mousemove", e => {
  if (!dragging || !selected) return;
  selected.setAttribute("x", e.offsetX - offsetX);
  selected.setAttribute("y", e.offsetY - offsetY);
});

window.addEventListener("mouseup", () => dragging = false);

svg.addEventListener("click", () => {
  if (selected) selected.classList.remove("selected");
  selected = null;
});

function select(el) {
  document.querySelectorAll("text").forEach(t => t.classList.remove("selected"));
  selected = el;
  el.classList.add("selected");
}

// ✅ SVG → PNG 저장 (GitHub Pages 가능)
document.getElementById("saveBtn").onclick = () => {
  const serializer = new XMLSerializer();
  const source = serializer.serializeToString(svg);

  const img = new Image();
  const svgBlob = new Blob([source], { type: "image/svg+xml;charset=utf-8" });
  const url = URL.createObjectURL(svgBlob);

  img.onload = () => {
    const canvas = document.createElement("canvas");
    canvas.width = 600;
    canvas.height = 600;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    URL.revokeObjectURL(url);

    const a = document.createElement("a");
    a.download = "오늘의_뇌구조.png";
    a.href = canvas.toDataURL("image/png");
    a.click();
  };

  img.src = url;
};
</script>

</body>
</html>
