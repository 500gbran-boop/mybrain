<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>오늘의 뇌구조 (SVG)</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#inputBox {
  width: 420px;
  height: 60px;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 12px;
  resize: none;
}

#controls {
  margin-bottom: 10px;
  display: none;
  gap: 10px;
  align-items: center;
}

#canvasWrap {
  background: #fff;
  border: 1px solid #ccc;
}

svg {
  user-select: none;
}

text.selected tspan {
  outline: 1px dashed #888;
}

button {
  margin-top: 12px;
  padding: 10px 20px;
  cursor: pointer;
}
</style>
</head>

<body>

<textarea id="inputBox" placeholder="머릿속 생각 입력 후 Enter + Shift로 줄바꿈"></textarea>

<div id="controls">
  중요도
  <input type="range" id="sizeSlider" min="12" max="60" value="24">
</div>

<div id="canvasWrap">
<svg id="brainSvg" width="600" height="600">
  <image
    href="data:image/png;base64,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"
    x="0" y="0" width="600" height="600"
    preserveAspectRatio="xMidYMid meet"
  />
</svg>
</div>

<button onclick="savePNG()">이미지 저장</button>

<script>
const svg = document.getElementById('brainSvg');
const input = document.getElementById('inputBox');
const slider = document.getElementById('sizeSlider');
const controls = document.getElementById('controls');

let selected = null;
let dragging = false;
let offset = { x: 0, y: 0 };

// 엔터 → 생각 생성 (Shift+Enter는 줄바꿈)
input.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey && input.value.trim()) {
    createThought(input.value.trim());
    input.value = '';
    e.preventDefault();
  }
});

function createThought(text) {
  const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
  t.setAttribute("x", 300);
  t.setAttribute("y", 300);
  t.setAttribute("fill", "#c0392b");
  t.setAttribute("font-size", 24);
  t.setAttribute("font-weight", "bold");
  t.style.cursor = "move";

  // 줄바꿈 처리
  text.split('\n').forEach((line, i) => {
    const tsp = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
    tsp.setAttribute("x", 300);
    tsp.setAttribute("dy", i === 0 ? "0" : "1.2em");
    tsp.textContent = line;
    t.appendChild(tsp);
  });

  t.addEventListener('mousedown', e => {
    selectThought(t);
    dragging = true;
    offset.x = e.offsetX - parseFloat(t.getAttribute("x"));
    offset.y = e.offsetY - parseFloat(t.getAttribute("y"));
  });

  t.addEventListener('click', e => {
    e.stopPropagation();
    enableInlineEdit(t);
  });

  svg.appendChild(t);
  selectThought(t);
}

function enableInlineEdit(textEl) {
  const x = parseFloat(textEl.getAttribute('x'));
  const y = parseFloat(textEl.getAttribute('y'));
  const fontSize = parseFloat(textEl.getAttribute('font-size'));

  const fo = document.createElementNS("http://www.w3.org/2000/svg", "foreignObject");
  fo.setAttribute("x", x - 5);
  fo.setAttribute("y", y - fontSize);
  fo.setAttribute("width", 300);
  fo.setAttribute("height", fontSize * 4);

  const textarea = document.createElement('textarea');
  textarea.value = Array.from(textEl.querySelectorAll('tspan')).map(t => t.textContent).join('\n');
  textarea.style.width = '100%';
  textarea.style.height = '100%';
  textarea.style.fontSize = fontSize + 'px';
  textarea.style.fontWeight = 'bold';
  textarea.style.border = '1px solid #aaa';
  textarea.style.resize = 'none';

  fo.appendChild(textarea);
  svg.appendChild(fo);
  textarea.focus();

  function commit() {
    textEl.innerHTML = '';
    textarea.value.split('\n').forEach((line, i) => {
      const tsp = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
      tsp.setAttribute("x", x);
      tsp.setAttribute("dy", i === 0 ? "0" : "1.2em");
      tsp.textContent = line;
      textEl.appendChild(tsp);
    });
    svg.removeChild(fo);
  }

  textarea.addEventListener('blur', commit);
  textarea.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      commit();
      e.preventDefault();
    }
  });
}

svg.addEventListener('mousemove', e => {
  if (!dragging || !selected) return;
  selected.setAttribute("x", e.offsetX - offset.x);
  selected.setAttribute("y", e.offsetY - offset.y);
});

document.addEventListener('mouseup', () => dragging = false);

function selectThought(t) {
  document.querySelectorAll('text').forEach(el => el.classList.remove('selected'));
  selected = t;
  t.classList.add('selected');
  controls.style.display = 'flex';
  slider.value = t.getAttribute("font-size");
}

svg.addEventListener('click', e => {
  if (e.target === svg) {
    selected = null;
    controls.style.display = 'none';
    document.querySelectorAll('text').forEach(el => el.classList.remove('selected'));
  }
});

slider.addEventListener('input', e => {
  if (selected) selected
