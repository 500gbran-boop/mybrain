<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>오늘의 뇌구조</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#inputBox {
  width: 420px;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 15px;
}

svg {
  background: #fff;
  border: 1px solid #ccc;
}
.editable {
  font-size: 24px;
  font-weight: bold;
  color: #c0392b;
  cursor: move;
  outline: none;
  white-space: nowrap;
}
</style>
</head>

<body>

<input id="inputBox" placeholder="지금 머릿속 생각 입력 후 Enter">

<svg id="brainSVG" width="600" height="600"
     xmlns="http://www.w3.org/2000/svg">

  <image
    href="data:image/png;base64(정상적인_전체_base64)"
    x="0" y="0" width="600" height="600" />

</svg>

<button onclick="saveSVG()">이미지 저장</button>

<script>
const svg = document.getElementById("brainSVG");
const input = document.getElementById("inputBox");

let selected = null;
let offset = { x: 0, y: 0 };

input.addEventListener("keydown", e => {
  if (e.key === "Enter" && input.value.trim()) {
    createText(input.value.trim());
    input.value = "";
  }
});

function createText(text) {
  const fo = document.createElementNS("http://www.w3.org/2000/svg", "foreignObject");
  fo.setAttribute("x", 250);
  fo.setAttribute("y", 280);
  fo.setAttribute("width", 300);
  fo.setAttribute("height", 50);

  const div = document.createElement("div");
  div.className = "editable";
  div.contentEditable = "true";
  div.textContent = text;

  div.addEventListener("mousedown", e => {
    selected = fo;
    offset.x = e.offsetX;
    offset.y = e.offsetY;
    e.stopPropagation();
  });

  fo.appendChild(div);
  svg.appendChild(fo);
}

// 드래그
svg.addEventListener("mousemove", e => {
  if (!selected) return;
  selected.setAttribute("x", e.offsetX - offset.x);
  selected.setAttribute("y", e.offsetY - offset.y);
});

svg.addEventListener("mouseup", () => selected = null);
svg.addEventListener("mouseleave", () => selected = null);

// SVG 저장
function saveSVG() {
  const serializer = new XMLSerializer();
  const source = serializer.serializeToString(svg);
  const blob = new Blob([source], { type: "image/svg+xml;charset=utf-8" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "오늘의_뇌구조.svg";
  a.click();

  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
